<!DOCTYPE html>

<body>


    <script>
        // create canvas element and append it to document body
        var canvas = document.createElement('canvas');
        document.body.appendChild(canvas);

        // some hotfixes... ( ≖_≖)
        document.body.style.margin = 0;
        canvas.style.position = 'fixed';

        // get canvas 2D context and set him correct size
        var ctx = canvas.getContext('2d');
        resize();

        // last known position
        var pos = { x: 0, y: 0 };

        window.addEventListener('resize', resize);
        document.addEventListener('mousemove', draw);
        document.addEventListener('mousedown', setPosition);
        document.addEventListener('mouseenter', setPosition);
        document.addEventListener("keydown", (event) => {
            console.log(event.keyCode)
            if (event.keyCode === 82) {
                // reset
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            } else if (event.keyCode === 13 || event.keyCode === 67) {
                // confirm
                var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");  // here is the most important part because if you dont replace you will get a DOM 18 exception.


                window.location.href = image; // it will save locally
            }
        });

        function fileUpload(canvas) {
            let data = new FormData();
            canvas.toBlob(function (blob) {
                data.append('data', blob);

                axios
                    .post(`https://api.graph.cool/file/v1/MY-PROJECTID`, data, {
                        headers: {
                            'Content-Type': 'multipart/form-data',
                        },
                    })
                    .then(res => {
                        console.log(res)
                    });
            });
        }

        // new position from mouse event
        function setPosition(e) {
            pos.x = e.clientX;
            pos.y = e.clientY;
        }

        // resize canvas
        function resize() {
            ctx.canvas.width = window.innerWidth;
            ctx.canvas.height = window.innerHeight;
        }

        function draw(e) {
            // mouse left button must be pressed
            if (e.buttons !== 1) return;

            ctx.beginPath(); // begin

            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000000';

            ctx.moveTo(pos.x, pos.y); // from
            setPosition(e);
            ctx.lineTo(pos.x, pos.y); // to

            ctx.stroke(); // draw it!
        }
    </script>
</body>